<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <?!= includeExternalFile('styles.html') ?>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>
    function display_if_not_found(name){
      let displayError = '';
      if(name == ''){
         displayError += '<div class="error">';
         displayError += 'Veuillez entrer un nom correct dans le champs ci-dessus';
         displayError += '</div>';
         document.getElementById("display-judoka").innerHTML = displayError;
      }else{
        displayError += '<div class="error">';
        displayError += 'Le nom: <span class ="font-weight-bold">'+ name +'</span> est introuvable';
        displayError += '</div>';
        document.getElementById("display-judoka").innerHTML = displayError;
      }
    }
    function display_if_success(ar){
        var displayTable = '';
        displayTable += '<h3>Résultats</h3>';
        displayTable +='<table class="table align-middle bg-white"><thead class="bg-light">';
        displayTable += "<tr>";
        displayTable += "<th>Nom de l'Athlète</th>";
        displayTable += "<th>Age</th>";
        displayTable += "<th>Genre</th>";
        displayTable += "<th>Poids</th>";
        displayTable += "</tr></thead><tbody>";     
        
        let n = ar.length;
        let currentDate = new Date();
        for(let i = 0; i<n; i++){
            displayTable += "<tr>";
            displayTable += '<td><div class="d-flex align-items-center"><a href="#" alt="cliquez pour consulter ses stats">'+ar[0][0][1]+'</a></div></td>';
            let age = currentDate.getFullYear()- ar[0][0][2];
            displayTable += '<td><div class="d-flex align-items-center">'+age+'</div></td>';
            displayTable += '<td><div class="d-flex align-items-center">'+ar[0][1][1]+'</div></td>';
            displayTable += '<td><div class="d-flex align-items-center">'+ar[0][1][2].slice(1)+'Kg'+'</div></td>';
            displayTable += "</tr>";    
        }
        
        displayTable += '</tbody></table>';
        
        document.getElementById("display-judoka").innerHTML = displayTable;
    }
    function GetReport()
    {
      var name = document.getElementById("type").value;
      
      google.script.run.withSuccessHandler(function(ar) {
        console.log(ar[0]);
        if(ar.length > 0)
          display_if_success(ar);
        else{
          display_if_not_found(name);
        }
      }).getResultsSQL(name);
    
    }
    </script>
  </head>
  <body>
    <div class="container">

      <div class="row height d-flex justify-content-center align-items-center">

        <div class="col-md-8">

          <div class="search">
            <i class="fa fa-search"></i>
            <input type="text" class="form-control" placeholder="Entrez le nom du Judoka" id ="type">
            <button type = "submit" class="btn btn-warning" onclick="GetReport()">Recherche</button>
          </div>     
        </div>             
      </div>
      <div id="display-judoka" class=""></div>
      <div id="display-contest"></div>
    </div>
  </body>
</html>
